/*
 * English :
 *  The project is protected by the MPL open source agreement.
 * Open source agreement warning that prohibits deletion of project source code files.
 * The project is prohibited from acting in illegal areas.
 * All illegal activities arising from the use of this project are the responsibility of the second author, and the original author of the project is not responsible
 *
 *  中文：
 *  该项目由MPL开源协议保护。
 *  禁止删除项目源代码文件的开源协议警告内容。
 * 禁止使用该项目在非法领域行事。
 * 使用该项目产生的违法行为，由使用者或第二作者全责，原作者免责
 *
 * 日本语：
 * プロジェクトはMPLオープンソース契約によって保護されています。
 *  オープンソース契約プロジェクトソースコードファイルの削除を禁止する警告。
 * このプロジェクトは違法地域の演技を禁止しています。
 * このプロジェクトの使用から生じるすべての違法行為は、2番目の著者の責任であり、プロジェクトの元の著者は責任を負いません。
 *
 */

/*
 * English :
 *  The project is protected by the MPL open source agreement.
 * Open source agreement warning that prohibits deletion of project source code files.
 * The project is prohibited from acting in illegal areas.
 * All illegal activities arising from the use of this project are the responsibility of the second author, and the original author of the project is not responsible
 *
 *  中文：
 *  该项目由MPL开源协议保护。
 *  禁止删除项目源代码文件的开源协议警告内容。
 * 禁止使用该项目在非法领域行事。
 * 使用该项目产生的违法行为，由使用者或第二作者全责，原作者免责
 *
 * 日本语：
 * プロジェクトはMPLオープンソース契約によって保護されています。
 *  オープンソース契約プロジェクトソースコードファイルの削除を禁止する警告。
 * このプロジェクトは違法地域の演技を禁止しています。
 * このプロジェクトの使用から生じるすべての違法行為は、2番目の著者の責任であり、プロジェクトの元の著者は責任を負いません。
 *
 */

package moe.ore.core.net.packet

import moe.ore.core.helper.DEFAULT_TEA_KEY
import moe.ore.core.helper.buildFirstLayer
import moe.ore.core.helper.buildSecondLayer
import moe.ore.core.net.BotClient
import moe.ore.core.util.QQUtil
import moe.ore.helper.hex2ByteArray
import moe.ore.helper.toByteArray
import moe.ore.helper.toHexString

class ToService(val seq: Int, val commandName: String, val body: ByteArray) {
    var packetType: PacketType = PacketType.LoginPacket
}

enum class PacketType(val flag1: Int, val flag2: Byte) {
    /**
     * 登录包
     */
    LoginPacket(0xa, 0x2)

}

fun ToService.sendTo(client: BotClient) {
    val uin = client.uin
    val teaKey = when (packetType) {
        PacketType.LoginPacket -> DEFAULT_TEA_KEY

    }
    client.send(buildFirstLayer(uin, teaKey, packetType, buildSecondLayer(uin, commandName, body, packetType, seq)))
    // client.send("000008410000000A0200000004000000000B34363433313631785FA11E3FE1EC1D2CC570A60071D1307129F0DBDAE521B8C2A44EA673B61F232E8C5551ED68BE3DC10070E8D7E92E9C801BC5C454354584D5919D6DD2482E907B652E8DCD885902C9C2EA407C934A1FB91B0725AB6673D336C891C3D929E6E2F1719E096F13EBAFD62465FEA3AF82C6507AEC6464FF5ADAC6B7103D7BC4A4B12BFF7C96803A5BB1DA7AFE9B1CAE028F78AD322EF948686F6D137E902F3FA694328E08CA0C2ADCE4935758C9B49BCAB71A1BDC7FAF58D54C93C6009EEBA1EE281F8D6706AB1330E595D060D4672C597F5EB326678DF2B065A8C3506D84BF7DD7D318881CA36122E62B6B93CF2EE21E9276AE25E48EAF183BEF1B5B6D897AE771D19E371CED252BB9DE03BE7FA5A161A5CA75562CFF724C8FDF9F28CCCA8F9D798AB50612D7AD06DDB3806C1817ABC56C0DCF2574AA4A547417D68FA6B7331CC4353228A1E52F01218D3E1429DD57BED9607FA94768F8EDBA26B89EE1407487ED4B7B93A2F13ADCC1F22E5374F799A4FCE2B99478AF4C3FA8163026DB7EE4A32BAFCA1366753C33EE2867F86821473D849A0DFB4B8D146F93F098EE581824D7094759E311DF5CC25EC16B1D3C167F75FEE663AC3EB74DB1B8CA366A8D869040A9F65449F57C49581AE2C7BE4EC6EE7148C5AB3C93C233EF19F11FD68413358D2079E824EA5D6B9E6355F38D387412A886B37AAB90B62796461B974B11AF005CD2D4DCE1BE5EB26E7DDE2B3A8B77B1E067EBB423A4567E2B209CFA949B0FECC23BCB1D3D346378637F9E460821C8CF7F0B5008732950623755DE8B6817FB8CB59873ECEBA68B2230B7B8BE12C80F5A3F28CE57B18F6F8D79F4E871BFD63AC23233C589F98EF69177C1DA57DF2E99F5769CADE763188938FDA4F0E732B7567EBFD5BE5A1546733693A2C5AFE61DD60D909FD17F28A1B9D9BF1A2777A05DB6D6852D9DBFE07C2AAE8347559C671BC7CD508244C04F24FB93EB94D8ADA9CDBD972FF9EBEA722ED4B051FA17F0D2D4C874973BC1E73EE29AC1E2D8D78C616A56FC412A13642E163F6D2381EC4031D477CBFC6A62DC4EF1E9ECD43677514B00C98CCC9B4D13BAD7D70563FB464D68AE6733A27964A9421DCFE5EB88A6CE557BF353C48D5AAE436C0019857B90606B3F5AE667B9B28CF7CE0F3DC872CB64375D184A29769547BA68C65FCC1CC4968416FD9673800AD5B3A7616665D75C52B9C8CF5268975213D464C454D180EF7C232D91E5D686F159440530780E2EF07CC76130B80A50FC59000C9D2E6904AF8634FF301BE817E1920DD0A7F2F0D6ABB0746BF86E9B93B75424D83EE85DB85F9E7B8E7803B42714E9D758D0658387DD6A7F3B37B6DB8DE76918BAE24F04580B54DE3DE7610F7473BD9BC2E0DE35D4C313BB73CFE9E0939E3BA4CB0B62CB1A8CF0BF16F15A233DCA89F33C3321FB0210704DBA097A3C361DEC02B502350DC6353B2DF70FA3F4DC5E48CB2DE812CFB76573A809467921BFF885E22AE66EA6FC76AC896560533CCDD3BD89FBCC45C82A1DE3ACA704392B6547FF3734C344BE4BCDF8AD46D1AFC2D0656E2F8C3929E300A12FB2346394EDDCA59EDC696A76D4162622ED3BA0B629BAD5BA384A56C414E5CD0CB2331FEF7554C6C4121E3A37DF612932FB8D635A1E04735597B07FF44EBF3CDDFF425B127E1189076198B7B86A6762D8FF07B04BB04105A5672717459220C9C2D7D01BCD26DC0BE414A5C93C4E08E9481A6CBB8E6708F9E34317922FE6AE22481FDE52E51D842D94AEFFCDC26284A023071CC07A9C85805C02EE724DCAF7786B82A83C7B6CD90DE222FF2868730BE1E5682B314063C0D49F6958F68C7557E14E687493A41C7EE3AD86B6AB5B87254084C6D91AE9016FD2CA673CD1A3569575061EB4943BC963F57FEDCB1D523C140B6E3CE247C3588DC7D69AE00616EF1257F05859F36BA2357C360D67E1A5E3406068CA5BE96FB1A34BD40D3CACB757CC6F26F48CCDD307AEBBA21883657C4C34DF15947B71E1AE761E4167C9149F2B03E54E48D9E1EEA2312F13D74F888F99EC730F3699A876D4E1DE6637992B6D6BD193FB12B8CB98E534025F7B5223CDA514CC256C229BEA9C0B085F8D57B6BAD06F47C3428F18AA46709C10730A776143C7FDCB297EDE9DBC453C313B7C59014FA29B57CD104F14B5A9DBAE154B1C60EB308416F416C8B46534B84117B3CE8A62F62A59BA9F7D9411315590065AF4ACB795ADB0FEA19D8947F033E63677EB48E6DB9A2655E78A46E21A3A322E21A4755C59F3857677E535E86BADB5D2F20670755C6D233F76F77D07D15EDA3BC0C5A5D109989D59793B9AAE4210A95F55B2DA8202423271622E0AF7DA44D5380DB305366C6F1A336EA67A6157E61B1526F40966DAFA9D1CEAAAE18316AD6486C103C69A4918AB6265207CE97E31F50FCCC18C1B566F7B25CF56DA01CAFB119336950CCDD74BC4C48396A94ED1751886930AEBF0D3248F9EAF373B08A9888901B5FDF90490ABEA9104A85ADF5060F1BBEC88739CA031101C0FE07B0A6DAEFCF6C8F668A5C680290D8C7176C432734A5C68391BF589B8D5F58BD5109E779E184563E2D7467143FCDCE41482B936F916B33159D0612CCE901FAF47E56BF0A7A23FA50F3F042D4B594E88BA3BD9536A5374A6E35FA684F6F19A01834EDFE6CEE53A087871A77E1E01E3F062CBB257AA0C81796BB1AA2335B7E4945E780B8FF4319A1FA862C925A1970D4E3998E04E27C0CA14086CC45ACAF6B357B97CEAFD83CDDCC8D0C65FAD1AA1F33C7B3AD93E9A61F7475ED92524963D8B0DB6E51C3AA77E66BE1E114101D5BB302406F840020CEDDD0557AD65850435F8D48B9CE6F1B3E46EDC6517B110F549C238EBEEA507C9650C5A95DBC6427B4B096E0B509D467F854374D89CF41DB9310AAFE7513206AF286B6DF2F6B30C3F9A223D9BFE3E1E1C688042561DFEEE".hex2ByteArray())
}

data class FromService(
    val seq: Int,
    val commandName: String,
    val body: ByteArray
) {
    override fun equals(other: Any?): Boolean {
        if (this === other) return true
        if (javaClass != other?.javaClass) return false

        other as FromService

        if (seq != other.seq) return false
        if (commandName != other.commandName) return false
        if (!body.contentEquals(other.body)) return false

        return true
    }

    override fun hashCode(): Int {
        return QQUtil.hash(seq, commandName)
    }
}